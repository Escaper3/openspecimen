<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">


	<property name="text.type" value="varchar" dbms="mysql" />
	<property name="text.type" value="varchar2" dbms="oracle" />

	<property name="int.type" value="bigint(20)" dbms="mysql" />
	<property name="int.type" value="number(19,0)" dbms="oracle" />
	
	<property name="date.type" value="date" dbms="mysql" />
	<property name="date.type" value="date" dbms="oracle" />
	
	<changeSet id="1" author="catissue" runOnChange="true">
		<addColumn tableName="CATISSUE_CP_REQ_SPECIMEN">
			<column name="ACTIVITY_STATUS" type="${text.type}(20)" />
		</addColumn>
	</changeSet>
	<changeSet id="2" author="catissue" runOnChange="true" failOnError="false">
		<addUniqueConstraint constraintName="CATISSUE_SPEC_POS_UNIQUE_KEY"
			tableName="catissue_specimen_position" columnNames="SPECIMEN_ID" />
	</changeSet>
	<changeSet id="3" author="catissue" failOnError="false">
		<sql>delete from CATISSUE_QUERY_EDITLINK_COLS where TABLE_ID = (select Table_ID from CATISSUE_QUERY_TABLE_DATA where DISPLAY_NAME = 'Participant')</sql>
	</changeSet>
	<changeSet id="4" author="catissue" failOnError="false">
		<sql>INSERT INTO CATISSUE_CDE VALUES ( '2004300','Collection Status','Collection Status',1.0,null)</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64557,'Pending',NULL,'2004300')</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64558,'Pending-Partially Complete',NULL,'2004300')</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64559,'Overdue',NULL,'2004300')</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64560,'Overdue-Partially Complete',NULL,'2004300')</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64561,'Complete',NULL,'2004300')</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64562,'Complete-Late',NULL,'2004300')</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64563,'Incomplete',NULL,'2004300')</sql>
		<sql>INSERT INTO CATISSUE_PERMISSIBLE_VALUE (IDENTIFIER, VALUE, PARENT_IDENTIFIER, PUBLIC_ID) VALUES(64564,'Not Collected',NULL,'2004300')</sql>
	</changeSet>
	
	
	<changeSet id="5" author="catissue" runOnChange="true">

		<createTable tableName="CATISSUE_STOR_CONT_UTILIZATION">
			<column name="STORAGE_CONTAINER_ID" type="${int.type}">
				<constraints nullable="false" />
			</column>
			<column name="STORED_SPECIMEN_COUNT" type="${int.type}">
				<constraints nullable="false" />
			</column>
			<column name="DATE" type="${date.type}">
				<constraints nullable="false" />
			</column>
			<column name="UTILIZATION_PERCENTAGE" type="${int.type}">
				<constraints nullable="false" />
			</column>
		</createTable>
		
		<addForeignKeyConstraint constraintName="FK_STORAGE_CONTAINER_ID"
			baseTableName="CATISSUE_STOR_CONT_UTILIZATION" baseColumnNames="STORAGE_CONTAINER_ID"
			referencedTableName="CATISSUE_STORAGE_CONTAINER" referencedColumnNames="IDENTIFIER" /> 
	
		<createIndex tableName="CATISSUE_STOR_CONT_UTILIZATION" indexName="CATISSUE_STOR_CONT_UTILIZATION_CONT_ID">
    		<column name="STORAGE_CONTAINER_ID"/>
		</createIndex>
	</changeSet>
	<changeSet id="6" author="catissue" runOnChange="true" failOnError="false">
		<sql>update catissue_address set country ='United States' where country is null;</sql>
		<sql>update catissue_address set city ='Not Specified' where city is null;</sql>
		<sql>commit;</sql>
	</changeSet>
	<changeSet id="7" author="pathik" runOnChange="true" failOnError="false">
		<sql>insert into catissue_specimen_protocol  (IDENTIFIER, PRINCIPAL_INVESTIGATOR_ID, TITLE, SHORT_TITLE,  IRB_IDENTIFIER, START_DATE, END_DATE, ENROLLMENT, DESCRIPTION_URL,  ACTIVITY_STATUS, LABEL_FORMAT, DERIV_LABEL_FORMAT, ALIQUOT_LABEL_FORMAT,  PPID_FORMAT) values (-1, 1, 'D', 'D','', NULL, NULL, 0, '','Disabled', NULL, NULL, NULL,NULL);
</sql>
		<sql>insert into catissue_collection_protocol  (IDENTIFIER, UNSIGNED_CONSENT_DOC_URL, ALIQUOT_IN_SAME_CONTAINER,  CONSENTS_WAIVED, CP_TYPE, PARENT_CP_ID, SEQUENCE_NUMBER,  STUDY_CALENDAR_EVENT_POINT, IS_EMPI_ENABLE) values (-1, '', 0, 0, 'Parent', NULL, 0,0, 0);
</sql>
		<sql>commit;</sql>
	</changeSet>
	<changeSet id="8" author="pathik" runOnChange="true" failOnError="false">
		<addColumn tableName="catissue_collection_protocol">
			<column name="DEFAULT_REPORTS_SEND_TO" type="${text.type}(20)" />
		</addColumn>
	</changeSet>
	<changeSet id="9" author="pathik" dbms="mysql">
		<addAutoIncrement tableName="REPORT_DETAILS"
			columnName="IDENTIFIER" columnDataType="${int.type}" />
	</changeSet>
	
	

<changeSet author="mosin" id="9">
    <addNotNullConstraint 
            columnDataType="${int.type}"
            columnName="POSITION_DIMENSION_ONE"
            defaultNullValue="0"
            tableName="catissue_abstract_position"/>
     <addNotNullConstraint 
            columnDataType="${int.type}"
            columnName="POSITION_DIMENSION_TWO"
            defaultNullValue="0"
            tableName="catissue_abstract_position"/>
      <addNotNullConstraint 
            columnDataType="${text.type}(20)"
            columnName="POSITION_DIMENSION_ONE_STRING"
            defaultNullValue=""
            tableName="catissue_abstract_position"/>
       <addNotNullConstraint 
            columnDataType="${text.type}(20)"
            columnName="POSITION_DIMENSION_TWO_STRING"
            defaultNullValue=""
            tableName="catissue_abstract_position"/>
</changeSet>

	
</databaseChangeLog>         
