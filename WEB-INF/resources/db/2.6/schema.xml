<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

  <changeSet author="vgaikwad" id="Column to specify specimen label pre print mode">
    <addColumn tableName="CATISSUE_COLLECTION_PROTOCOL">
      <column name="SPMN_LABEL_PRE_PRINT_MODE" type="${text.type}(32)">
      </column>
    </addColumn>
  </changeSet>
  
  <changeSet author="vgaikwad" id="Column to specify specimen label auto print mode">
    <addColumn tableName="CATISSUE_CP_REQ_SPECIMEN">
      <column name="LABEL_AUTO_PRINT_MODE" type="${text.type}(32)">
      </column>
    </addColumn>
  </changeSet>
  
  <changeSet author="nmarwaha" id="Rename date to migration_date in os_migraitons table">
    <renameColumn
      columnDataType="${timestamp.type}"
      oldColumnName="DATE"
      newColumnName="MIGRATION_DATE"
      tableName="OS_MIGRATIONS"/>
  </changeSet>
  
  <changeSet author="nmarwaha" id="Convert clob to varchar: Added temporary column tmp_description in specimen list tag table" dbms="oracle">
    <addColumn tableName="CATISSUE_SPECIMENLIST_TAGS">
      <column name="TMP_DESCRIPTION" type="${text.type}(1000)"/>
    </addColumn>
  </changeSet>
  
  <changeSet author="nmarwaha" id="Convert clob to varchar: Moving data from clob to newly created varchar column" dbms="oracle">
    <sql>
      update 
        catissue_specimenlist_tags
      set 
        tmp_description = DBMS_LOB.SUBSTR (description, 1000);
    </sql>
  </changeSet>
  
  <changeSet author="nmarwaha" id="Convert clob to varchar: Delete the original description column" dbms="oracle">
    <dropColumn tableName="CATISSUE_SPECIMENLIST_TAGS" columnName="DESCRIPTION"/>
  </changeSet>
  
  <changeSet author="nmarwaha" id="Convert clob to varchar: Rename to temporary column to the actual one" dbms="oracle">
    <renameColumn
      columnDataType="${text.type}(1000)"
      oldColumnName="TMP_DESCRIPTION"
      newColumnName="DESCRIPTION"
      tableName="CATISSUE_SPECIMENLIST_TAGS"/>
  </changeSet>
  
</databaseChangeLog>
