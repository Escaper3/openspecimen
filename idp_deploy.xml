<?xml version ="1.0"?>
<!--Ant Script for create Build for caTissue Suite-->

<project name="caTissue Suite v1.1P2.IDP">
	<import file="deploy.xml"/>
	
		<target name="deploy_app_with_idp">
		    <antcall target="pre_initialization" />
			<if>
				<equals arg1="mysql" arg2="${database.type}" />
			<then>
					<antcall target="mysql_csm_config_with_idp"/>
			</then>
			<elseif>
					<equals arg1="oracle" arg2="${database.type}" />
			<then>
					<antcall target="oracle_csm_config_with_idp"/>
			</then>
			</elseif>
			</if>
			<antcall target="IdPSettings"/>
			<antcall target="db_configuration" />
			<antcall target="integrate_advanced_query"/>
		    <antcall target="app_configuration"/>
			<antcall target="de_integrate_app" />
			<antcall target="build_war" />
			<antcall target="jboss_configuration" />
			<antcall target="send_mail" />
			<delete dir="${temp.dir}" />
		</target>
	
		  <target name="mysql_csm_config_with_idp" >
	    	<copy file="${base.dir}/idp_catissuecore-ds.xml" tofile="${temp.dir}/catissuecore-ds.xml" overwrite="true"/>
			<copy file="${base.dir}/idp_login-config.xml" tofile="${temp.dir}/login-config.xml" overwrite="true"/>
			<copy file="${base.dir}/idp_upt.hibernate.cfg.xml" tofile="${temp.dir}/catissuecore-properties/upt.hibernate.cfg.xml" overwrite="true"/>
			<copy file="${base.dir}/idp_catissuecore.hibernate.cfg.xml" tofile="${temp.dir}/catissuecore-properties/catissuecore.hibernate.cfg.xml" overwrite="true"/>
			<replace dir="${temp.dir}" propertyfile="caTissueInstall.properties">
					<include name="catissuecore-ds.xml" />
					<include name="login-config.xml" />				
				<replacefilter token="@@CSMdatabaseurl@@" value="jdbc:mysql://${csm.database.host}:${csm.database.port}:${csm.database.name}"/>
				<replacefilter token="@@CSMusername@@" value="${csm.database.username}"/>
				<replacefilter token="@@CSMpasword@@" value="${csm.database.password}"/>
				</replace>
		</target>	
	
		<target name="oracle_csm_config_with_idp">
			<copy file="${base.dir}/idp/idp_catissuecore-ds.xml" tofile="${temp.dir}/catissuecore-ds.xml" overwrite="true"/>
			<copy file="${base.dir}/idp/idp_login-config.xml" tofile="${temp.dir}/login-config.xml" overwrite="true"/>
			<copy file="${base.dir}/idp/idp_upt.hibernate.cfg.xml" tofile="${temp.dir}/catissuecore-properties/upt.hibernate.cfg.xml" overwrite="true"/>
			<copy file="${base.dir}/idp/idp_catissuecore.hibernate.cfg.xml" tofile="${temp.dir}/catissuecore-properties/catissuecore.hibernate.cfg.xml" overwrite="true"/>
			<replace dir="${temp.dir}" propertyfile="caTissueInstall.properties"> 
						<include name="catissuecore-ds.xml" />
						<include name="login-config.xml" />				
					<replacefilter token="@@CSMdatabaseurl@@" value="jdbc:oracle:thin:@${csm.database.host}:${csm.database.port}:${csm.database.name}"/>
					<replacefilter token="@@CSMusername@@" value="${csm.database.username}"/>
					<replacefilter token="@@CSMpasword@@" value="${csm.database.password}"/>
			</replace>
		</target> 
	
		<target name="deploy_all_with_idp">
			<antcall target="deploy_app_with_idp" />
			<antcall target="deploy_db" />
			<antcall target="server_security" />
		</target>
	
	<!-- IDP settings -->
		
	<target name="IdPSettings">
		<copy file="${base.dir}/catissuecore-properties/IdPConfigure.xml" tofile="${temp.dir}/catissuecore-properties/IdPConfigure.xml" overwrite="true"/>
		<replace dir="${temp.dir}/catissuecore-properties" propertyfile="caTissueInstall.properties">
			<include name="IdPConfigure.xml" />

			<replacefilter token="@@clinportal.database.type@@" value="${clinportal.database.type}" />
			<replacefilter token="@@clinportal.database.name@@"  value="${clinportal.database.name}" />
			<replacefilter token="@@clinportal.database.host@@" value="${clinportal.database.host}" />
			<replacefilter token="@@clinportal.database.username@@" value="${clinportal.database.username}" />
			<replacefilter token="@@clinportal.database.password@@" value="${clinportal.database.password}" />
			<replacefilter token="@@clinportal.database.port@@" value="${clinportal.database.port}" />
			

			<replacefilter token="@@catissuecore.database.type@@" value="${database.type}" />
			<replacefilter token="@@catissuecore.database.name@@"  value="${database.name}" />
			<replacefilter token="@@catissuecore.database.host@@" value="${database.host}" />
			<replacefilter token="@@catissuecore.database.username@@" value="${database.username}" />
			<replacefilter token="@@catissuecore.database.password@@" value="${database.password}" />
			<replacefilter token="@@catissuecore.database.port@@" value="${database.port}" />
	
	
			<replacefilter token="@@csm.database.type@@" value="${csm.database.type}" />
			<replacefilter token="@@csm.database.name@@"  value="${csm.database.name}" />
			<replacefilter token="@@csm.database.host@@" value="${csm.database.host}" />
			<replacefilter token="@@csm.database.username@@" value="${csm.database.username}" />
			<replacefilter token="@@csm.database.password@@" value="${csm.database.password}" />
			<replacefilter token="@@csm.database.port@@" value="${csm.database.port}" />
			
	</replace>
	<if>
		<equals arg1="oracle" arg2="${clinportal.database.type}" />	
		<then>
			<replace dir="${temp.dir}/catissuecore-properties" propertyfile="caTissueInstall.properties">
			<include name="IdPConfigure.xml" />
					<replacefilter token="@@clinportal.database.driverURL@@" value="${oracle.driver.string}" />
					<replacefilter token="@@csm.database.driverURL@@" value="${oracle.driver.string}" />
				<replacefilter token="@@catissuecore.database.driverURL@@" value="${oracle.driver.string}" />
			</replace>	
		</then>
	<elseif >
		<equals arg1="mysql" arg2="${clinportal.database.type}" />
		<then>
			<replace dir="${temp.dir}/catissuecore-properties" propertyfile="caTissueInstall.properties">
				<include name="IdPConfigure.xml" />
				<replacefilter token="@@clinportal.database.driverURL@@" value="${mysql.driver.string}" />
				<replacefilter token="@@csm.database.driverURL@@" value="${mysql.driver.string}" />
				<replacefilter token="@@catissuecore.database.driverURL@@" value="${mysql.driver.string}" />
		</replace>
		</then>
	</elseif>
	</if>	
	</target>
	<!-- IDP settings ends-->
	
	</project>
	
