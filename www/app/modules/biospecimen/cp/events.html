<div class="os-items-group">
  <div class="os-item">
    <h3 class="os-section-title">
      {{cp.title}}
    </h3>
  </div>
</div>

<div class="clearfix">
  <div class="col-xs-12">
    <div class="alert alert-warning" ng-if="!events || events.length == 0">
      <span translate="cp.no_cpes">There are no collection protocol events. Please add an event</span>
    </div>
  </div>

  <div class="col-xs-3">
    <div class="list-group">
      <div class="list-group-item os-section-hdr">
        <span translate="cp.cpe_list">Events</span>
      </div>

      <div ng-repeat="evt in events | orderBy:['eventPoint', 'eventLabel']" class="os-cpe-item">
        <div class="os-enable-on-hover" ng-if="evt.id != event.id">
          <a class="list-group-item" 
            ui-sref="cp-detail.specimen-requirements({eventId: evt.id})" 
            ui-sref-active="active"
            ng-click="selectEvent(evt)">
            T{{evt.eventPoint}}: {{evt.eventLabel}} 
          </a>
          <p class="os-action-btns btn-group" style="top: 0px;">
            <button class="btn btn-xs btn-default" ng-click="showEditEvent($event, evt)">
              <span class="fa fa-pencil"></span>
            </button>
            <button class="btn btn-xs btn-default">
              <span class="fa fa-remove"></span>
            </button>
          </p>
        </div>
        <div ng-if="evt.id == event.id" class="os-inplace-form-edit-po"> 
          <div class="list-group-item">
            <div class="title">T{{evt.eventPoint}}: {{evt.eventLabel}}</div>
            <div class="content" ng-include="'event-add-edit.html'"></div>
          </div>
        </div>
      </div>

      <a class="list-group-item" translate="cp.add_cpe" ng-click="showAddEvent()" ng-if="!addMode">
        Add Event ...
      </a>
      <div ng-if="addMode" class="os-inplace-form-edit-po">
        <div class="list-group-item">
          <div class="title">New Event</div>
          <div class="content" ng-include="'event-add-edit.html'"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xs-9" ng-if="events.length > 0">
    <div ui-view></div>
  </div>
</div>

<script type="text/ng-template" id="event-add-edit.html">
  <form name="eventForm" os-form-validator="eventForm" novalidate>
    <div class="form-group clearfix">
      <input os-md-input autofocus type="text" class="form-control" placeholder="{{'cp.cpe_point' | translate}}" 
        name="eventPoint" ng-model="event.eventPoint" required ng-pattern="/^[0-9]+$/">
      <div os-field-error field="eventForm.eventPoint"></div>
    </div>

    <div class="form-group clearfix">
      <input os-md-input type="text" class="form-control" placeholder="{{'cp.cpe_point_label' | translate}}"
        name="eventLabel" ng-model="event.eventLabel" required>
      <div os-field-error field="eventForm.eventLabel"></div>
    </div>

    <div class="form-group clearfix">
      <div os-md-input ng-model="event.clinicalDiagnosis" placeholder="{{'cp.clinical_diagnosis' | translate}}">
        <os-select name="clinicalDiagnosis" ng-model="event.clinicalDiagnosis" 
          list="clinicalDiagnoses" refresh="searchClinicalDiagnoses"
          os-md-input placeholder="{{'cp.clinical_diagnosis' | translate}}" required>
        </os-select>
      </div>
      <div os-field-error field="eventForm.clinicalDiagnosis"></div>
    </div>

    <div class="form-group clearfix">
      <os-select os-md-input name="clinicalStatus" ng-model="event.clinicalStatus" list="clinicalStatuses" 
        placeholder="{{'cp.clinical_status' | translate}}" required> </os-select>
      <div os-field-error field="eventForm.clinicalStatus"></div>
    </div>

    <div class="form-group clearfix">
      <os-select os-md-input name="defaultSite" ng-model="event.defaultSite" list="sites" 
        placeholder="{{'cp.default_site' | translate}}" required> </os-select>
      <div os-field-error field="eventForm.defaultSite"></div>
    </div>

    <div class="form-group">
      <button type="submit" class="btn btn-success" os-form-submit="addEvent()" ng-if="!event.id" translate="common.buttons.add">
        Add
      </button>
      <button type="submit" class="btn btn-success" os-form-submit="editEvent()" ng-if="event.id" translate="common.buttons.save">
        Save
      </button>
      <a class="btn os-btn-text-secondary" ng-click="revertEdit()" translate="common.buttons.cancel">
        Cancel
      </a>
    </div>
  </form>
</script>
