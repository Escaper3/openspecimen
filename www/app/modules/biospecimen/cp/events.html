<div class="os-items-group">
  <div class="os-item">
    <h3 class="os-section-title">
      {{cp.title}}
    </h3>
  </div>
</div>

<div class="clearfix">
  <div class="col-xs-3">
    <div class="list-group">
      <div class="list-group-item os-section-hdr">
        <span translate="cp.cpe_list">Events</span>
      </div>

      <div ng-repeat="evt in events | orderBy:['eventPoint', 'eventLabel']" class="os-cpe-item">
        <div class="os-enable-on-hover" ng-if="evt.id != event.id">
          <a class="list-group-item" 
            ui-sref="cp-detail.specimen-requirements({eventId: evt.id})" 
            ui-sref-active="active"
            ng-click="selectEvent(evt)">
            T{{evt.eventPoint}}: {{evt.eventLabel}} 
          </a>
          <p class="os-action-btns btn-group" style="top: 0px;">
            <button class="btn btn-xs btn-default" ng-click="showEditEvent($event, evt)">
              <span class="fa fa-pencil"></span>
            </button>
            <button class="btn btn-xs btn-default">
              <span class="fa fa-remove"></span>
            </button>
          </p>
        </div>
        <div ng-if="evt.id == event.id"> 
          <div class="os-quick-edit-overlay"></div>
          <div class="list-group-item os-quick-edit" ng-include="'event-add-edit.html'"></div>
        </div>
      </div>

      <a class="list-group-item" translate="cp.add_cpe" ng-click="showAddEvent()" ng-if="!addMode">
        Add Event ...
      </a>
      <div class="list-group-item" ng-include="'event-add-edit.html'" ng-if="addMode"></div>
    </div>
  </div>
  <div class="col-xs-9">
    <div ui-view></div>
  </div>
</div>

<script type="text/ng-template" id="event-add-edit.html">
  <form name="eventForm" os-form-validator="eventForm" novalidate>
    <div class="form-group">
      <input autofocus type="text" class="form-control" placeholder="{{'cp.cpe_point' | translate}}" 
        name="eventPoint" ng-model="event.eventPoint" required ng-pattern="/^[0-9]+$/">
      <div os-field-error field="eventForm.eventPoint"></div>
    </div>
    <div class="form-group">
      <input type="text" class="form-control" placeholder="{{'cp.cpe_point_label' | translate}}"
        name="eventLabel" ng-model="event.eventLabel" required>
      <div os-field-error field="eventForm.eventLabel"></div>
    </div>
    <div class="form-group">
      <ui-select name="clinicalDiagnosis" ng-model="event.clinicalDiagnosis" required>
        <ui-select-match placeholder="{{'cp.clinical_diagnosis' | translate}}">
          {{$select.selected}}
        </ui-select-match>
        <ui-select-choices repeat="cd in clinicalDiagnoses" refresh="searchClinicalDiagnoses($select.search)" refresh-delay="750">
          <span ng-bind-html="cd | highlight: $select.search"></span>
        </ui-select-choices>
      </ui-select>
      <div os-field-error field="eventForm.clinicalDiagnosis"></div>
    </div>
    <div class="form-group">
      <ui-select name="clinicalStatus" ng-model="event.clinicalStatus" required>
        <ui-select-match placeholder="{{'cp.clinical_status' | translate}}">
          {{$select.selected}}
        </ui-select-match>
        <ui-select-choices repeat="cs in clinicalStatuses">
          <span ng-bind-html="cs | highlight: $select.search"></span>
        </ui-select-choices>
      </ui-select>
      <div os-field-error field="eventForm.clinicalStatus"></div>
    </div>
    <div class="form-group">
      <ui-select ng-model="event.defaultSite">
        <ui-select-match placeholder="{{'cp.default_site' | translate}}">
          {{$select.selected}}
        </ui-select-match>
        <ui-select-choices repeat="site in sites">
          <span ng-bind-html="site | highlight: $select.search"></span>
        </ui-select-choices>
      </ui-select>
      <div os-field-error field="eventForm.defaultSite"></div>
    </div>
    <div class="form-group">
      <button type="submit" class="btn btn-success" os-form-submit="addEvent()" ng-if="!event.id" translate="common.buttons.add">
        Add
      </button>
      <button type="submit" class="btn btn-success" os-form-submit="editEvent()" ng-if="event.id" translate="common.buttons.save">
        Save
      </button>
      <a class="btn os-btn-text-secondary" ng-click="revertEdit()" translate="common.buttons.cancel">
        Cancel
      </a>
    </div>
  </form>
</script>
