<div>
  <div class="os-modal-header">
    <span> Create Collection Protocol </span>
    <a class="os-close" ng-click="cancel()">&times;</a>
  </div>
  <div class="os-modal-body">
    <alert ng-if="alert" type="{{alert.type}}" class="os-alert">{{alert.msg}}</alert>

    <div os-wizard="cpWizard">
      <os-wizard-step on-finish="" title="Basic Info">
        <div ng-include="'cp-basic-info.html'"></div>
      </os-wizard-step>

      <os-wizard-step on-finish="" title="Consent">
        <div ng-include="'cp-consents.html'"></div>
      </os-wizard-step>

      <os-wizard-step on-finish="" title="Add Events">
        <div ng-include="'cp-events.html'"></div>
      </os-wizard-step>
      
      <div class="os-modal-footer">
        <button class="btn os-btn-text" ng-click="cancel()">
          Cancel
        </button>
        <button class="btn os-btn-secondary" ng-if="!cpWizard.isFirstStep()"
          ng-click="cpWizard.previous(false)">
          Previous
        </button>
        <button class="btn btn-primary" ng-if="!cpWizard.isLastStep()"
          ng-click="cpWizard.next(false)">
          Next
        </button>
        <button class="btn btn-primary" ng-click="save()" ng-if="cpWizard.isLastStep()">
          Create
        </button>
      </div>
    </div>
  </div>
</div>

<script type="text/ng-template" id="cp-basic-info.html">
  <form>
    <div class="form-group clearfix">
      <div class="col-xs-6">
        <label class="control-label">Principle Investigator</label>
        <ui-select ng-model="collectionProtocol.pi">
          <ui-select-match placeholder="Select User">{{$select.selected.lastName}}, {{$select.selected.firstName}} </ui-select-match>
          <ui-select-choices repeat="user in users | filter: $select.search">
            <span ng-bind-html="user.lastName + ', '+ user.firstName | highlight: $select.search"></span>
          </ui-select-choices>
        </ui-select>
      </div>
    </div>
    <div class="form-group clearfix">
      <div class="col-xs-12">
        <label class="control-label">Protocol Coordinators</label>
        <ui-select multiple ng-model="collectionProtocol.coordinator">
          <ui-select-match placeholder="Select User">{{$item.lastName}}, {{$item.firstName}}</ui-select-match>
          <ui-select-choices repeat="user in users | filter: $select.search">
            <span ng-bind-html="user.lastName + ', '+ user.firstName | highlight: $select.search"></span>
          </ui-select-choices>
        </ui-select>
      </div>
    </div>
    <div class="form-group clearfix">
      <div class="col-xs-12">
        <label class="control-label">Title</label>
        <textarea class="form-control" ng-model="collectionProtocol.title" placeholder="Title" maxlength="512" required></textarea>
      </div>
    </div>
    <div class="form-group clearfix">
      <div class="col-xs-12">
        <label class="control-label">Short Title</label>
        <input type="text" class="form-control" ng-model="collectionProtocol.shortTitle" placeholder="Short Title" maxlength="255" required>
      </div>
    </div>
    <div class="form-group clearfix">
      <div class="col-xs-6">
        <label class="control-label">IRB ID</label>
        <input type="text" class="form-control" ng-model="collectionProtocol.irbId" placeholder="IRB ID">
      </div>
    </div>
  </form>
</script>

<script type="text/ng-template" id="cp-consents.html">
  <form>
    <div class="form-group clearfix">
      <div class="col-xs-12">
        <label class="control-label">Unsigned Form Url</label>
        <input type="text" class="form-control" ng-model="collectionProtocol.consents" placeholder="Unsigned Form Url">
      </div>
    </div>

    <div class="form-group clearfix">
      <div class="col-xs-12 os-section-hdr">
        <label>Consent Tiers</label>
      </div>
    </div>

    <div class="form-group clearfix" ng-if="collectionProtocol.statements.length > 0">
      <div class="col-xs-10">
        <label class="control-label">Statements</label>
      </div>
    </div>


    <div class="form-group clearfix" ng-repeat="statement in collectionProtocol.statements">
      <div class="col-xs-10">
        <input type="text" class="form-control" ng-model="statement.text" placeholder="Statement">
      </div>
      <div class="col-xs-2">
        <button class="btn btn-default" ng-click="removeStatement($index)">
          <span class="glyphicon glyphicon-trash"></span>
        </button>
      </div>
    </div>

    <div class="form-group">
      <button class="btn os-btn-text os-btn-col" ng-click="addStatement()">
        <span class="glyphicon glyphicon-plus"></span>
        Add Statement
      </button>
   </div>
  </form>
</script>

<script type="text/ng-template" id="cp-events.html">
  <div class="row">
    <div class="col-xs-3">
      <div>
        <os-tree opts="treeOpts"></os-tree>
      </div>
      <div>
        <button class="btn btn-primary" ng-click="addEvents();">
          Add Event
        </button>
      </div>
      <div>
        {{collectionProtocol}}
      </div>
    </div>

    <div ng-if="currentView == 'home'">
    </div>

    <div class="col-xs-9" ng-if="currentView == 'specimen-requirement'">
      <div ng-include="'specimen-requirement.html'"></div>
    </div>

    <div class="col-xs-9" ng-if="currentView == 'add-edit-event'" >
      <form>
        <div class="form-group clearfix">
          <div class="col-xs-6">
            <label class="control-label">Study Calendar Event Point </label>
            <input type="text" class="form-control" ng-model="event.eventPoint" placeholder="Event Point" required>
          </div>
          <div class="col-xs-6">
            <label class="control-label">Collection Point Label</label>
            <input type="text" class="form-control" ng-model="event.pointLabel" placeholder="Collection Point Label" required>
          </div>
        </div>

        <div class="form-group clearfix">
          <div class="col-xs-6">
            <label class="control-label">Clinical Diagnosis</label>
            <ui-select ng-model="event.clinicalDiagnosis">
              <ui-select-match placeholder="Select Clinical Diagnosis">{{$select.selected}}</ui-select-match>
              <ui-select-choices repeat="clinicalDiagnosis in clinicalDiagnosis_pvs | filter: $select.search">
                <span ng-bind-html=" clinicalDiagnosis| highlight: $select.search"></span>
              </ui-select-choices>
            </ui-select>
          </div>

          <div class="col-xs-6">
            <label class="control-label">Clinical Status</label>
            <ui-select ng-model="event.clinicalStatus">
              <ui-select-match placeholder="Select Clinical Status">{{$select.selected}}</ui-select-match>
              <ui-select-choices repeat="clinicalStatus in clinicalStatus_pvs | filter: $select.search">
                <span ng-bind-html="clinicalStatus | highlight: $select.search"></span>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group clearfix">
          <div class="col-xs-6">
            <label class="control-label">Default Collection Site</label>
            <ui-select ng-model="event.defaultSite">
              <ui-select-match placeholder="Default Collection Site">{{$select.selected.name}}</ui-select-match>
              <ui-select-choices repeat="site in sites | filter: $select.search">
                <span ng-bind-html="site.name | highlight: $select.search"></span>
              </ui-select-choices>
            </ui-select>
          </div>
        </div>

        <div class="form-group clearfix">
          <div class="pull-right">
            <button class="btn btn-primary" ng-click="addSpecimenRequirements();" ng-if="event.type">
                  Add Specimen Requirements
            </button>
            <button class="btn btn-primary" ng-click="saveOrUpdateEvents();">
              <span ng-if="!event.type"> Add </span>
              <span ng-if="event.type"> Update </span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</script>

<script type="text/ng-template" id="node-tmpl.html">
  <div><a href="" ng-click="nodeChecked(node)"> {{node.val}} </a></div>
</script>

<script type="text/ng-template" id="specimen-requirement.html">
  <form>
    <div class="form-group clearfix">
      <div class="col-xs-12">
        <label class="control-label">Specimen Requirement Title </label>
        <input type="text" class="form-control" placeholder="Specimen Requirement Title" required>
      </div>
    </div>
    <div class="form-group clearfix">
      <div class="pull-right">
        <button class="btn btn-primary" on-click="saveSpecimenRequirement()">
          Save
        </button>
      </div>
    </div>
  </form>
</script>


