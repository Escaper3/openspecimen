
<div class="os-items-group">
  <div class="os-item">
    <h3 class="os-section-title" ng-switch on="!!(cpr.participant.lastName || cpr.participant.firstName)"> 
      <span ng-switch-when="true">
        {{cpr.participant.firstName}} {{cpr.participant.lastName}}
      </span>
      <span ng-switch-when="false" translate="common.na">
        N/A
      </span>
    </h3>
  </div>

  <div class="os-item os-action-btns os-action-btns-md">
    <a><span class="glyphicon glyphicon-pencil"></span></a>
  </div>
</div>

<div class="clearfix">
  <div class="col-xs-8">
    <ul class="os-key-values os-two-cols" os-inline-editors on-save="editCpr">
      <li class="item">
        <strong class="key key-sm" translate="participant.birth_date">Birth Date:</strong>
        <os-inline-edit editor="bdEditor" name="birthDate" class="value value-md" value="cpr.participant.birthDate">
          <span ng-if="bdEditor.isDisplayMode()">{{bdEditor.viewValue | date: 'MMM dd, yyyy' | osNoValue}}</span>
          <input ng-if="bdEditor.isEditMode()" class="form-control" type="text" ng-model="bdEditor.editValue"
            datepicker-popup="yyyy-MM-dd" show-button-bar="false" is-open="dt.isOpen" ng-focus="dt.isOpen=true">
        </os-inline-edit>
      </li>

      <li class="item">
        <strong class="key key-sm" translate="participant.pmis">Medical Identifiers:</strong>
        <span class="value value-md" os-inline-edit>{{cpr.participant.pmis | osFormatCollection:getMrnDisplayText | osNoValue}}</span>
      </li>

      <li class="item">
        <strong class="key key-sm" translate="participant.reg_date">Registration Date:</strong>
        <os-inline-edit editor="rdEditor" name="regDate" class="value value-md" value="cpr.registrationDate">
          <span ng-if="rdEditor.isDisplayMode()">{{rdEditor.viewValue | date: 'MMM dd, yyyy' | osNoValue}}</span>
          <input ng-if="rdEditor.isEditMode()" class="form-control" type="text" ng-model="rdEditor.editValue"
            datepicker-popup="yyyy-MM-dd" show-button-bar="false" is-open="dt.isOpen" ng-focus="dt.isOpen=true">
        </os-inline-edit>
      </li>

      <li class="item">
        <strong class="key key-sm" translate="participant.protocol_id">Protocol Identifier:</strong>
        <os-inline-edit editor="ppidEditor" name="ppid" class="value value-md" value="cpr.ppid">
          <span ng-if="ppidEditor.isDisplayMode()">{{ppidEditor.viewValue | osNoValue}}</span>
          <input ng-if="ppidEditor.isEditMode()" type="text" ng-model="ppidEditor.editValue" class="form-control" 
            required placeholder="Participant Protocol ID">
        </os-inline-edit>
      </li>

      <li class="item">
        <strong class="key key-sm" translate="participant.ssn_short">Social Security No:</strong>
        <os-inline-edit editor="ssnEditor" name="ssn" class="value value-md" value="cpr.participant.ssn">
          <span ng-if="ssnEditor.isDisplayMode()">{{ssnEditor.viewValue | osNoValue}}</span>
          <input ng-if="ssnEditor.isEditMode()" type="text" ng-model="ssnEditor.editValue" class="form-control" 
              ui-mask="999-99-9999" placeholder="XXX-XX-XXXX">
        </os-inline-edit>
      </li>

      <li class="item">
        <strong class="key key-sm" translate="participant.gender">Gender:</strong>
        <os-inline-edit editor="genderEditor" name="gender" class="value value-md" value="cpr.participant.gender">
          <span ng-if="genderEditor.isDisplayMode()">{{genderEditor.viewValue | osNoValue}}</span>
          <div ng-if="genderEditor.isEditMode()">
            <os-select ng-model="genderEditor.editValue" list="genders"></os-select>
          </div>
        </os-inline-edit>
      </li>

      <li class="item">
        <strong class="key key-sm" translate="participant.vital_status">Vital Status:</strong>
        <os-inline-edit editor="vsEditor" name="vitalStatus" class="value value-md" value="cpr.participant.vitalStatus">
          <span ng-if="vsEditor.isDisplayMode()">{{vsEditor.viewValue | osNoValue}}</span>
          <div ng-if="vsEditor.isEditMode()">
            <os-select ng-model="vsEditor.editValue" list="vitalStatuses"></os-select>
          </div>
        </os-inline-edit>
      </li>

      <li class="item">
        <strong class="key key-sm" translate="participant.race">Race:</strong>
        <os-inline-edit editor="raceEditor" name="race" class="value value-md" value="cpr.participant.race">
          <span ng-if="raceEditor.isDisplayMode()">{{raceEditor.viewValue.join(", ") | osNoValue}}</span>
          <div ng-if="raceEditor.isEditMode()">
            <os-select ng-model="raceEditor.editValue" list="races" multiple></os-select>
          </div>
        </os-inline-edit>
      </li>
    </ul>

    <div class="os-section" ng-init="ovCollapsed=false">
      <button class="os-btn-section-collapse os-btn-transparent" ng-click="ovCollapsed=!ovCollapsed">
        <span ng-if="!ovCollapsed">&#9660;</span>
        <span ng-if="ovCollapsed">&#9654;</span>
      </button>
      <h3 class="os-sub-section-title" translate="visits.occurred_visits">Occurred Visits</h3>
      <div collapse="ovCollapsed">
        <span ng-if="occurredVisits.length == 0" translate="common.none">None</span>
        <table class="table table-hover os-table-muted-hdr os-table outer-border" ng-if="occurredVisits.length > 0">
          <thead>
            <tr>
              <th class="col-xs-5" translate="visits.title">Visit</th>
              <th class="col-xs-2" translate="common.date">Date</th>
              <th class="col-xs-4" translate="visits.collection_status">Collection Status</th>
              <th class="col-xs-1">&nbsp;</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="visit in occurredVisits" ng-mouseenter="showBtns=true" ng-mouseleave="showBtns=false">
              <td>
                <a ui-sref="participant-detail.visits({visitId: visit.id, eventId: visit.eventId})">
                  T{{visit.calendarPoint}}: {{visit.label}}
                </a>
              </td>
              <td>{{visit.visitDate | date: 'MMM dd, yyyy'}}</td>
              <td>
                <progress class="progress" max="visit.totalSpecimens"
                  bs-popover trigger="hover" placement="bottom" content-template="specimen-count.html">
                  <bar value="visit.collectedSpecimens" type="success"><span><b> {{visit.collectedSpecimens}} </b> </span></bar>
                  <bar value="visit.pendingSpecimens" type="warning"><span><b> {{visit.pendingSpecimens}} </b> </span></bar>
                  <bar value="visit.uncollectedSpecimens" type="danger"><span><b> {{visit.uncollectedSpecimens}} </b> </span></bar>
                  <bar value="visit.unplannedSpecimens" type="info"><span><b> {{visit.unplannedSpecimens}} </b> </span></bar>
                </progress>
              </td>
              <td>
                <div class="btn-group" dropdown ng-if="showBtns">
                  <button type="button" class="btn btn-xs btn-default os-btn-icon">
                    <span class="fa fa-cog"></span>
                  </button>
                  <button type="button" class="btn btn-xs btn-default os-btn-icon dropdown-toggle">
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#" translate="visits.ctx_menu.view_visit">View Visit</a></li>
                    <li><a href="#" translate="visits.ctx_menu.edit_visit">Edit Visit</a></li>
                    <li class="divider"></li>
                    <li><a href="#" translate="visits.ctx_menu.collect_planned_specimens">Collect Planned Specimens</a></li>
                    <li><a href="#" translate="visits.ctx_menu.collect_unplanned_specimens">Collect Unplanned Specimens</a></li>
                    <li><a href="#" translate="visits.ctx_menu.print_specimen_labels">Print Specimen Labels</a></li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="os-section" ng-init="avCollapsed=false">
      <button class="os-btn-section-collapse os-btn-transparent" ng-click="avCollapsed=!avCollapsed">
        <span ng-if="!avCollapsed">&#9660;</span>
        <span ng-if="avCollapsed">&#9654;</span>
      </button>
      <h3 class="os-sub-section-title" translate="visits.anticipated_visits">Anticipated Visits</h3>
      <div collapse="avCollapsed">
        <span ng-if="anticipatedVisits.length == 0" translate="common.none">None</span>
        <table class="table table-hover os-table-muted-hdr os-table outer-border" ng-if="anticipatedVisits.length > 0">
          <thead>
            <tr>
              <th class="col-xs-5" translate="visits.title">Visit</th>
              <th class="col-xs-3" translate="common.date">Date</th>
              <th class="col-xs-3" translate="visits.anticipated_specimens">Anticipated Specimens</th>
              <th class="col-xs-1">&nbsp;</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="visit in anticipatedVisits" ng-mouseenter="showBtns=true" ng-mouseleave="showBtns=false">
              <td>
                <a ui-sref="participant-detail.visits({visitId: visit.id, eventId: visit.eventId})">
                  T{{visit.calendarPoint}}: {{visit.label}}
                </a>
              </td>
              <td>{{visit.anticipatedVisitDate | date: 'MMM dd, yyyy'}}</td>
              <td>{{visit.anticipatedSpecimens}}</td>
              <td>
                <div class="btn-group" ng-if="showBtns">
                  <button type="button" class="btn btn-xs btn-default os-btn-icon">
                    <span class="fa fa-sign-in"></span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-xs-4">
    <h3 class="os-sub-section-title"> Recent Activity </h3>
    <ul class="os-activity-list">
      <li class="os-activity">
        <div class="title"><a>Specimen abc disposed</a></div>
        <div class="info"><span>User 1 - an hour ago</span></div>
      </li>
      <li class="os-activity">
        <div class="title"><a>Specimen xyz aliquoted into 4 specimens</a></div>
        <div class="info"><span>User 1 - 5 hrs ago</span></div>
      </li>
      <li class="os-activity">
        <div class="title"><a>Specimen xyz under visit SCG1 collected</a></div>
        <div class="info"><span>User 1 - 10 hrs ago</span></div>
      </li>
      <li class="os-activity">
        <div class="title"><a>Visit SCG1 completed</a></div>
        <div class="info"><span> User 1 - 20 hrs ago</span></div>
      </li>
      <li class="os-activity">
        <div class="title"><a>Consent Response Updated</a></div>
        <div class="info"><span> User 1 - Nov 10, 2014 </span></div>
      </li>
    </ul>
  </div>
</div>

<script id="specimen-count.html" type="text/ng-template">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th translate="visits.collection_status">Collection Status</th>
        <th translate="common.count">Count</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td translate="specimens.status.collected">Collected</td>
        <td>{{visit.collectedSpecimens}}</td>
      </tr>
      <tr>
        <td translate="specimens.status.pending">Pending</td>
        <td>{{visit.pendingSpecimens}}</td>
      </tr>
      <tr>
        <td translate="specimens.status.not_collected">Not Collected</td>
        <td>{{visit.uncollectedSpecimens}}</td>
      </tr>
      <tr>
        <td translate="specimens.unplanned">Unplanned</td>
        <td>{{visit.unplannedSpecimens}}</td>
      </tr>
    </tbody>
  </table>
</script>
