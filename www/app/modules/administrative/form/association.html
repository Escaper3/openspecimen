<div ng-if="showFormCtxts" class="os-form-association os-no-label-form">
  <div class="os-modal-header">
    <h4>{{form.caption}}</h4>
  </div>

  <div class="os-modal-body">
    <div class="os-form-association-empty-list" ng-if="!cpFormCtxts || cpFormCtxts.length == 0">
      <h5><i translate="form.not_used">Not used in any collection protocols</i></h5>   
    </div>
    <div class="os-form-association-list" ng-if="cpFormCtxts && cpFormCtxts.length > 0">
      <div class="os-section">
        <table class="os-table">
          <thead class="os-table-head">
            <tr class="row">
              <th class="col col-xs-3">
                <span translate="form.level">Level</span>
              </th>
              <th class="col col-xs-5">
                <span translate="form.collection_protocol">Collection Protocol</span>
              </th>
              <th class="col col-xs-3">
                <span>&nbsp;</span>
              </th>
              <th class="col col-xs-1">
                <span>&nbsp;</span>
              </th>
            </tr>
          </thead>
          <tbody class="os-table-body">
            <tr class="row" ng-repeat="ctxt in cpFormCtxts">
              <td class="col col-xs-3">
                <span>{{ctxt.level.caption}}</span>
              </td>
              <td class="col col-xs-5">
                <span>{{ctxt.collectionProtocol.shortTitle}}</span>
              </td>
              <td class="col col-xs-3">
                <span class="os-tag" ng-if="ctxt.multiRecord" translate="form.multiple_records">Multiple Records</span>
              </td>
              <td class="col col-xs-1">
                <span class="btn-group btn-group-xs" ng-if="!ctxt.sysForm && ctxt.level.allowEdits !== false">
                  <button class="btn btn-default" ng-click="confirmRemoveCtx(ctxt, $index)">
                    <span class="fa fa-trash-o"></span>
                  </button>
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="os-form-association-form">
      <os-select ng-model="cpFormCtxt.selectedEntity" list="extnEntities" display-prop="caption"
        placeholder="{{'form.select_level' | translate }}" append-to-body="true">
      </os-select>
      <div class="checkbox" ng-show="cpFormCtxt.selectedEntity && !cpFormCtxt.selectedEntity.allCps && currentUser.admin">
        <label>
          <input type="checkbox" ng-checked="cpFormCtxt.allProtocols" ng-model="cpFormCtxt.allProtocols"/> 
          <span translate="form.all_cps">All Present and Future Collection Protocols</span>
        </label>
      </div>
      <os-select multiple ng-model="cpFormCtxt.selectedCps" list="cpList" display-prop="shortTitle"
        placeholder="{{'form.select_cps' | translate}}" name="cps" append-to-body="true" 
        ng-show="!cpFormCtxt.allProtocols && cpFormCtxt.selectedEntity && !cpFormCtxt.selectedEntity.allCps">
      </os-select>
      <div class="checkbox" ng-show="cpFormCtxt.selectedEntity && cpFormCtxt.selectedEntity.multipleRecs != false">
        <label>
          <input type="checkbox" ng-checked="cpFormCtxt.isMultiRecord" ng-model="cpFormCtxt.isMultiRecord"/>
          <span translate="form.multiple_records_allowed">Multiple records allowed</span>
        </label>
      </div>
    </div>
  </div>

  <div class="os-modal-footer" ng-switch on="enableAttach(cpFormCtxt)">
    <button ng-switch-when="true"  class="btn os-btn-text" ng-click="cancel()">
      <span translate="common.buttons.cancel">Cancel</span>
    </button>
    <button ng-switch-when="true"  class="btn btn-primary" ng-click="attach(cpFormCtxt)">
      <span translate="form.attach_form">Attach Form</span>
    </button>
    <button ng-switch-when="false" class="btn btn-primary" ng-click="cancel()">
      <span translate="common.buttons.done">Done</span>
    </button>
  </div>
</div>

<div ng-if="!showFormCtxts">
  <div class="os-modal-header">
    <h4>{{form.caption}}</h4>
  </div>
  
  <div class="os-modal-body">
   <span translate="form.confirm_delete_association" translate-values="removeCtxData.ctx">
     Are you sure you want to delete this form at Participant level from ALL protocols? <br/>
     Please note you will no longer be able to access data for this form
   </span>
  </div>

  <div class="os-modal-footer">
    <button class="btn os-btn-text" ng-click="cancelRemoveCtx()" translate="common.buttons.cancel">Cancel</button>
    <button class="btn btn-danger"  ng-click="removeCtx()"       translate="common.buttons.delete">Delete</button>
  </div>
</div> 

