
<div>
  <div class="os-page-hdr">
    <h3 translate="user.create_user_title">Create User</h3> 
  </div>
  
  <div os-wizard="userWizard">
    <os-wizard-step on-finish="validateProfile" title="{{'user.profile' | translate}}">
      <div ng-include="'user-add-edit.html'"></div>
    </os-wizard-step>
    <os-wizard-step title="{{'user.permissions' | translate}}">
      <div ng-include="'user-role.html'"></div>
    </os-wizard-step>
  </div>
  
  <div class="form-group">
    <div class="col-xs-offset-3 col-xs-6 ">
      <button class="btn btn-primary" ng-if="!user.isSuperAdmin && !userWizard.isLastStep()" ng-click="userWizard.next(false)">
        Next
      </button>
      <button class="btn os-btn-secondary" ng-if="!userWizard.isFirstStep()" ng-click="userWizard.previous(false)">
        Previous
      </button>
      <button class="btn btn-primary" ng-click="createUser()" translate="common.buttons.create" 
        ng-if="user.isSuperAdmin || userWizard.isLastStep()">
        Create 
      </button>
      <button class="btn os-btn-text" ng-click="$window.history.back();" translate="common.buttons.discard"> 
        Discard 
      </button>
    </div>
  </div>  
</div>

<script type="text/ng-template" id="user-add-edit.html"> 
  <form name="userForm" class="form-horizontal" os-form-validator="userForm" validator="userFormValidator" novalidate>
    <div class="container">
      <div class="form-group">
        <label class="col-xs-3 control-label" translate="user.name">Name</label>
        <div class="col-xs-4">
          <input type="text" name="lastName" ng-model="user.lastName" class="form-control" 
            placeholder="{{'user.last_name' | translate}}" required/>
          <div os-field-error field="userForm.lastName"></div>
          <span class="error" ng-show="submitted && userForm.lastName.$error.required">Required!</span>
        </div>
        
        <div class="col-xs-4">
          <input type="text" name="firstName" ng-model="user.firstName" class="form-control" 
            placeholder="{{'user.first_name' | translate}}" required/>
          <div os-field-error field="userForm.firstName"></div>
        </div>
      </div>
      
      <div class="form-group">
        <label class="col-xs-3 control-label" translate="user.login_details">Login Details</label>
        <div class="col-xs-4">
          <ui-select ng-model="user.domainName" name="domain" required>
            <ui-select-match placeholder="{{'user.select_domain' | translate}}">
              {{$select.selected}}
            </ui-select-match>
            <ui-select-choices repeat="domain in domains_pvs | filter: $select.search">
              <span ng-bind-html="domain | highlight: $select.search"></span>
            </ui-select-choices>
          </ui-select>
          <div os-field-error field="userForm.domain"></div>
        </div>
        
        <div class="col-xs-4">
          <input type="text" name="loginName" class="form-control" ng-model="user.loginName" 
            placeholder="{{'user.login_name' | translate}}" ng-maxlength="255" required>
          <div os-field-error field="userForm.loginName"></div>
        </div>
      </div>
       
      <div class="form-group">
        <label class="col-xs-3 control-label" translate="user.email_address">Email Address</label>
        <div class="col-xs-4">
          <input type="email" name="email" class="form-control" ng-model="user.emailAddress" 
            placeholder="{{'user.email_address' | translate}}" ng-maxlength="255" required>
          <div os-field-error field="userForm.email"></div>
        </div>
      </div>
      
      <div class="form-group">
        <label class="col-xs-3 control-label">Institution</label>
        <div class="col-xs-4">
          <ui-select ng-model="instituteName" name="institute" ng-change="resetDepartmentName()" 
            on-select="getDepartments($item.name,true)" required>
            <ui-select-match placeholder="{{'user.select_institute' | translate}}"> 
              {{$select.selected.name}} 
            </ui-select-match>
            <ui-select-choices repeat="institute.name as institute in institutes | filter: $select.search">
              <span ng-bind-html="institute.name | highlight: $select.search"></span>
            </ui-select-choices>
          </ui-select>
          <div os-field-error field="userForm.institute"></div>
        </div>
        
        <div class="col-xs-4">
          <ui-select name="department" ng-model="user.deptName" required>
            <ui-select-match placeholder="{{'user.select_department' | translate}}"> 
              {{$select.selected.name}} 
            </ui-select-match>
            <ui-select-choices repeat="department.name as department in departments | filter: $select.search">
              <span ng-bind-html="department.name | highlight: $select.search"></span>
            </ui-select-choices>
          </ui-select>
          <div os-field-error field="userForm.department"></div>
        </div>
      </div>
    
      <div class="form-group">
        <label class="col-xs-3 control-label" translate="user.super_admin">Super Administrator</label>
        <div class="col-xs-9">
          <label class="checkbox-inline">
            <input type="checkbox" ng-model="user.isSuperAdmin"/> Yes
          </label>
        </div>
      </div>
      
      <div class="form-group">
        <label class="col-xs-3 control-label" translate="user.address">Address</label>
        <div class="col-xs-6">
          <textarea rows="2" placeholder="{{'user.address' | translate}}" ng-model="user.address" 
            class="form-control">
          </textarea>
        </div>
      </div>
      <div class="os-divider"></div>
    </div>
  </form>
  <div ng-init="setForm(userForm)"></div>
</script>

<script type="text/ng-template" id="user-role.html">
  <div class="container">
    <div class="form-group clearfix">
      <div class="col-xs-3 col-xs-offset-2">
        <label class="control-label" translate="user.site">Site</label>
      </div>
      <div class="col-xs-3">
        <label class="control-label" translate="user.cp">Collection Protocol</label>
      </div>
      <div class="col-xs-3">
        <label class="control-label" translate="user.role">Role</label>
      </div>
    </div>
    
    <div class="form-group clearfix" ng-repeat="userCPRoles in user.userCPRoles">
      <div class="col-xs-3 col-xs-offset-2">
        <ui-select ng-model="userCPRoles.site">
          <ui-select-match placeholder="{{'user.select_site' | translate}}"> 
            {{userCPRoles.site}} 
          </ui-select-match>
          <ui-select-choices repeat="site.name as site in sites | highlight: $select.search">
            <span ng-bind-html="site.name | highlight: $select.search"></span>
          </ui-select-choices>
        </ui-select>
      </div>
       
      <div class="col-xs-3">
        <ui-select ng-model="userCPRoles.cp">
          <ui-select-match placeholder="{{'user.select_cp' | translate}}"> 
            {{userCPRoles.cp}} 
          </ui-select-match>
          <ui-select-choices repeat="cp.shortTitle as cp in cps | filter: $select.search">
            <span ng-bind-html="cp.shortTitle | highlight: $select.search"></span>
          </ui-select-choices>
        </ui-select>
      </div>
    
      <div class="col-xs-3">
        <ui-select ng-model="userCPRoles.role">
          <ui-select-match placeholder="{{'user.select_role' | translate}}"> 
            {{userCPRoles.role}} 
          </ui-select-match>
          <ui-select-choices repeat="role.name as role in roles | filter: $select.search">
            <span ng-bind-html="role.name | highlight: $select.search"></span>
          </ui-select-choices>
        </ui-select>
      </div>
     
      <div class="col-xs-1">
        <button class="btn btn-default" ng-click="removePermission($index)">	
          <span class="glyphicon glyphicon-trash"></span>
        </button>
      </div>
    </div>  
    
    <div class="form-group clearfix">
      <div class="col-xs-3 col-xs-offset-2">
        <a ng-click="addPermission()">
          <span class="glyphicon glyphicon-plus"></span>
        </a>
        <span translate="user.add_permission"> Add Permission </span>
      </div>
    </div>
    <div class="os-divider"></div>
  </div>
</script>
